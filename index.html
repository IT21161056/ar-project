<!DOCTYPE html>
<html>
<head>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script>
      AFRAME.registerComponent('animation-handler', {
          init: function () {
              this.el.addEventListener('model-loaded', () => {
                  console.log('Model loaded');
                  const model = this.el.getObject3D('mesh');
                  if (model) {
                      console.log('Found model, checking animations');
                      if (model.animations && model.animations.length > 0) {
                          console.log('Found animations:', model.animations.length);
                          
                          // Create animation mixer
                          const mixer = new THREE.AnimationMixer(model);
                          
                          // Play all animations
                          model.animations.forEach(animation => {
                              console.log('Playing animation:', animation.name);
                              const action = mixer.clipAction(animation);
                              action.setLoop(THREE.LoopRepeat);
                              action.clampWhenFinished = false;
                              action.enabled = true;
                              action.play();
                          });

                          // Store mixer for update
                          this.mixer = mixer;
                          
                          // Set animation speed (adjust this value to control speed)
                          this.mixer.timeScale = 1.0;
                      } else {
                          console.log('No animations found in model');
                      }
                  }
              });
          },
          tick: function (time, deltaTime) {
              if (this.mixer) {
                  // Update the animation mixer with the correct time delta
                  this.mixer.update(deltaTime / 1000);
              }
          }
      });
  </script>
</head>
<body style='margin: 0; overflow: hidden;'>
    <a-scene embedded arjs debug>
        <a-marker preset="hiro" debug>
            <!-- Load the animated GLB model -->
            <a-entity
            position="0 0 0"
            rotation="0 0 0"
            scale="1 1 1"
            gltf-model="assets/source/Venom.glb"
            animation-handler>
        </a-entity>
        </a-marker>
        <a-entity camera></a-entity>
    </a-scene>
</body>
</html>
